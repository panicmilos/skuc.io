paketic skuc.io;

use informUser;
use dispatch;
use most common imports;

rule "Test inform"
  when
>    b: Number()
  then
    informUser()
      with "about" : "Milos %s je car broj %s"
      with "@param1" : "Panic"
      with "@param2" : "2"
    ===>
end;

rule "High temperature"
  when
    def $any = getAnyContextIfActive()
    def $max_temperature = C[$any][max_temperature]
    curr_temperature
      - vece od $max_temperature
  then
    dispatch(TemperatureTooHigh);
    sisaj("High temperature");
    dispatch(InformUser);
end;

rule "High CO2"
  when
    def $any = getAnyContextIfActive()
    def $max_co2 = C[$any][max_co2]
    curr_co2
      - vece od $max_co2
  then
    dispatch(CO2TooHigh);
    sisaj("High CO2");
    dispatch(InformUser);
end;

rule "Low humidity"
  when
    def $any = getAnyContextIfActive()
    def $min_humid = C[$any][min_humid]
    curr_humid
      - manje od $min_humid
  then
    dispatch(HumidTooLow);
    sisaj("Low humidity");
    dispatch(InformUser);
end;

rule "Potential fire"
  when
    TemperatureTooHigh has occured
    CO2TooHigh has occured
    HumidTooLow has occured
  then
    sisaj("Potential fire");
    dispatch(PotentialFire);
end;

rule "Close windows"
  when
    PotentialFire has occured
    are WindowsOpen()
  then
    sisaj("Close windows");
    dispatch(CloseWindows);
end;

rule "Turn off AC"
  when
    PotentialFire has occured
    is ACOn()
  then
    sisaj("AC turned off");
    dispatch(TurnOffAC);
end;

rule "Activate sprinklers"
  when
    PotentialFire has occured
  then
    sisaj("Sprinklers activated");
    dispatch(ActivateSprinklers);
    dispatch(SprinklersActivated);
end;

rule "Turn off electric devices"
  when
    SprinklersActivated has occured
    is AnyElectricDeviceOn()
  then
    sisaj("Electric devices turned off");
    dispatch(TurnOffAllElectricDevices);
end;